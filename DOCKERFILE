FROM ghcr.io/astral-sh/uv:0.10-python3.14-trixie-slim

# Ensure we use the venv's bin directory on PATH
ENV PATH="/workspaces/my-local-ai-environment/.venv/bin:$PATH"

# Need to enable this since docker doesn't support hardlinking
ENV UV_LINK_MODE=copy

# Install the fastmcp CLI (keeps uv tooling available)
RUN uv tool install 'fastmcp >= 3.0.0b'

WORKDIR /workspaces/my-local-ai-environment

# Copy minimal metadata first so layer caching keeps installs stable
COPY pyproject.toml ./

# Use `uv sync` to create the venv and install dependencies from pyproject (including dev group)
RUN uv sync --dev

# Copy the rest of the project
COPY . .

# Run the app using uv (keeps development tooling behavior)
CMD [ "uv", "run", "main.py" ]
